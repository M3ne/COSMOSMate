{"version":3,"file":"src_js_plugins_editSat_editSat_ts.84160ba022ab596525c6.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAwD;AACR;AACQ;AACjC;AACuB;AAC9C;AACO;AACP;AACA,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL;AACO;AACP;AACA,IAAI,6CAAC,uBAAuB,uEAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0IAA0I;AAC1I;AACA;AACA,6IAA6I;AAC7I;AACA;AACA,gIAAgI;AAChI;AACA;AACA,gIAAgI;AAChI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,6CAAC,yBAAyB,uEAAiB;AAC/C;AACA;AACA;AACA,eAAe,oDAAO,CAAC;AACvB;AACA;AACA;AACA;AACA,IAAI,6CAAC;AACL;AACA;AACA,YAAY,6CAAC;AACb,SAAS;AACT;AACA;AACA,KAAK;AACL,IAAI,6CAAC;AACL,IAAI,6CAAC;AACL,IAAI,6CAAC;AACL,IAAI,6CAAC;AACL,QAAQ,6CAAC;AACT,KAAK;AACL,IAAI,6CAAC;AACL;AACA,oBAAoB;AACpB;AACA;AACA,KAAK;AACL,IAAI,6CAAC;AACL,QAAQ,6CAAC;AACT,KAAK;AACL;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,YAAY,+CAA+C,EAAE,2EAAqB;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,+DAAc;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,QAAQ,6CAAC;AACT,QAAQ,6CAAC;AACT;AACA;AACO;AACP;AACA,YAAY,mCAAmC,EAAE,2EAAqB;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,6CAAC,oCAAoC,iCAAiC;AACtF,gBAAgB,6CAAC;AACjB;AACA;AACA,gBAAgB,6CAAC;AACjB,6CAA6C,0DAAO;AACpD;AACA;AACA;AACA;AACA,gBAAgB,6CAAC,gBAAgB,+DAAc;AAC/C,gBAAgB,6CAAC;AACjB,gBAAgB,6CAAC;AACjB,gBAAgB,6CAAC;AACjB,uCAAuC,0DAAO;AAC9C;AACA;AACA;AACA;AACA,gBAAgB,6CAAC,iBAAiB,+DAAc;AAChD,gBAAgB,6CAAC;AACjB,yCAAyC,0DAAO;AAChD;AACA;AACA;AACA;AACA,gBAAgB,6CAAC,kBAAkB,+DAAc;AACjD,gBAAgB,6CAAC;AACjB;AACA;AACA;AACA,oBAAoB,oHAA8D;AAClF;AACA,qBAAqB,6CAAC;AACtB,oBAAoB,6CAAC;AACrB;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACO;AACP,YAAY,2BAA2B,EAAE,2EAAqB;AAC9D;AACA;AACA;AACA;AACA,iCAAiC,oBAAoB;AACrD,aAAa;AACb;AACA;AACA;AACA;AACO;AACP,IAAI,6CAAC,oCAAoC,iCAAiC;AAC1E,IAAI,6CAAC;AACL;AACA;AACO;AACP,IAAI,6CAAC;AACL;AACO;AACP,YAAY,yEAAyE,EAAE,2EAAqB;AAC5G;AACA;AACA,6CAA6C,6CAAC;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,oGAA8C;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,6CAAC;AACb,+BAA+B,KAAK;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,QAAQ,6CAAC;AACT,qCAAqC,0DAAO;AAC5C;AACA;AACA;AACA;AACA,QAAQ,6CAAC,gBAAgB,+DAAc;AACvC,QAAQ,6CAAC;AACT,QAAQ,6CAAC;AACT,QAAQ,6CAAC;AACT,+BAA+B,0DAAO;AACtC;AACA;AACA;AACA;AACA,QAAQ,6CAAC,iBAAiB,+DAAc;AACxC,QAAQ,6CAAC;AACT,iCAAiC,0DAAO;AACxC;AACA;AACA;AACA;AACA,QAAQ,6CAAC,kBAAkB,+DAAc;AACzC,QAAQ,6CAAC;AACT;AACA;AACA;AACA;AACA,IAAI,6CAAC;AACL;AACO;AACP,YAAY,+CAA+C,EAAE,2EAAqB;AAClF,IAAI,6CAAC;AACL,gBAAgB,6CAAC;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,6CAAC;AACf,iBAAiB,6CAAC;AAClB,eAAe,6CAAC;AAChB,iBAAiB,6CAAC;AAClB,gBAAgB,6CAAC;AACjB,gBAAgB,6CAAC;AACjB,oBAAoB,6CAAC;AACrB,qBAAqB,6CAAC;AACtB,YAAY,aAAa,wBAAwB,0EAA0E;AAC3H;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,QAAQ,6CAAC;AACT,QAAQ,6CAAC;AACT;AACA;AACA;AACA;AACO;AACP,YAAY,SAAS,EAAE,2EAAqB;AAC5C;AACA,oBAAoB,6CAAC;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,SAAS;AACT,QAAQ,2DAAM;AACd;AACA;AACA;AACA;AACA;AACA","sources":["webpack://keeptrack.space/./src/js/plugins/editSat/editSat.ts"],"sourcesContent":["import { keepTrackApi } from '@app/js/api/keepTrackApi';\nimport { RAD2DEG } from '@app/js/lib/constants';\nimport { saveAs, stringPad } from '@app/js/lib/helpers';\nimport $ from 'jquery';\nimport editPng from '@app/img/icons/edit.png';\nlet isEditSatMenuOpen = false;\nexport const init = () => {\n    // Add HTML\n    keepTrackApi.register({\n        method: 'uiManagerInit',\n        cbName: 'editSat',\n        cb: () => uiManagerInit(),\n    });\n    // Add JavaScript\n    keepTrackApi.register({\n        method: 'bottomMenuClick',\n        cbName: 'editSat',\n        cb: (iconName) => bottomMenuClick(iconName),\n    });\n    keepTrackApi.register({\n        method: 'rmbMenuActions',\n        cbName: 'editSat',\n        cb: (iconName, clickedSat) => rmbMenuActions(iconName, clickedSat),\n    });\n    keepTrackApi.register({\n        method: 'hideSideMenus',\n        cbName: 'editSat',\n        cb: () => hideSideMenus(),\n    });\n};\nexport const uiManagerInit = () => {\n    // Side Menu\n    $('#left-menus').append(keepTrackApi.html `\n    <div id=\"editSat-menu\" class=\"side-menu-parent start-hidden text-select\">\n      <div id=\"editSat-content\" class=\"side-menu\">\n        <div class=\"row\">\n          <h5 class=\"center-align\">Edit Satellite</h5>\n          <form id=\"editSat\">\n            <div class=\"input-field col s12\">\n              <input disabled value=\"AAAAA\" id=\"es-scc\" type=\"text\" maxlength=\"5\" />\n              <label for=\"disabled\" class=\"active\">Satellite SCC#</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AA\" id=\"es-year\" type=\"text\" maxlength=\"2\" />\n              <label for=\"es-year\" class=\"active\">Epoch Year</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AAA.AAAAAAAA\" id=\"es-day\" type=\"text\" maxlength=\"12\" />\n              <label for=\"es-day\" class=\"active\">Epoch Day</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AAA.AAAA\" id=\"es-inc\" type=\"text\" maxlength=\"8\" />\n              <label for=\"es-inc\" class=\"active\">Inclination</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AAA.AAAA\" id=\"es-rasc\" type=\"text\" maxlength=\"8\" />\n              <label for=\"es-rasc\" class=\"active\">Right Ascension</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AAA.AAAA\" id=\"es-meanmo\" type=\"text\" maxlength=\"11\" />\n              <label for=\"es-meanmo\" class=\"active\">Mean Motion</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AA.AAAAAAAA\" id=\"es-ecen\" type=\"text\" maxlength=\"7\" />\n              <label for=\"es-ecen\" class=\"active\">Eccentricity</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AA.AAAAAAAA\" id=\"es-argPe\" type=\"text\" maxlength=\"8\" />\n              <label for=\"es-argPe\" class=\"active\">Argument of Perigee</label>\n            </div>\n            <div class=\"input-field col s12\">\n              <input placeholder=\"AAA.AAAA\" id=\"es-meana\" type=\"text\" maxlength=\"8\" />\n              <label for=\"es-meana\" class=\"active\">Mean Anomaly</label>\n            </div>\n            <div class=\"center-align row\">\n              <button id=\"editSat-submit\" class=\"btn btn-ui waves-effect waves-light\" type=\"submit\" name=\"action\">Update Satellite &#9658;</button>\n            </div>\n            <div class=\"center-align row\">\n              <button id=\"editSat-newTLE\" class=\"btn btn-ui waves-effect waves-light\" type=\"button\" name=\"action\">Update Epoch to Now &#9658;</button>\n            </div>\n            <div class=\"center-align row\">\n              <button id=\"editSat-save\" class=\"btn btn-ui waves-effect waves-light\" type=\"button\" name=\"action\">Save TLE &#9658;</button>\n            </div>\n            <div class=\"center-align row\">\n              <button id=\"editSat-open\" class=\"btn btn-ui waves-effect waves-light\" type=\"button\" name=\"action\">Load TLE &#9658;</button>\n              <input id=\"editSat-file\" class=\"start-hidden\" type=\"file\" name=\"files[]\" />\n            </div>\n          </form>\n        </div>\n        <div id=\"es-error\" class=\"center-align menu-selectable start-hidden\">\n          <h6 class=\"center-align\">Error</h6>\n        </div>\n      </div>\n    </div>\n  `);\n    // Bottom Icon\n    $('#bottom-icons').append(keepTrackApi.html `\n    <div id=\"menu-editSat\" class=\"bmenu-item bmenu-item-disabled\">\n      <img\n        alt=\"edit\"\n        src=\"${editPng}\"/>\n      <span class=\"bmenu-title\">Edit Satellite</span>\n      <div class=\"status-icon\"></div>\n    </div>\n  `);\n    $('#editSat-menu').resizable({\n        handles: 'e',\n        stop: function () {\n            $(this).css('height', '');\n        },\n        maxWidth: 450,\n        minWidth: 280,\n    });\n    $('#editSat-newTLE').on('click', editSatNewTleClick);\n    $('#editSat').on('submit', editSatSubmit);\n    $('#editSat-save').on('click', editSatSaveClick);\n    $('#editSat-open').on('click', function () {\n        $('#editSat-file').trigger('click');\n    });\n    $('#editSat-file').on('change', function (evt) {\n        if (!window.FileReader)\n            return; // Browser is not compatible\n        doReaderActions(evt);\n        evt.preventDefault();\n    });\n    $('#es-error').on('click', function () {\n        $('#es-error').hide();\n    });\n};\nexport const doReaderActions = (evt) => {\n    try {\n        const reader = new FileReader();\n        reader.onload = readerOnLoad;\n        reader.readAsText(evt.target.files[0]);\n    }\n    catch (e) {\n        // Intentionally left blank\n    }\n};\nexport const readerOnLoad = (evt) => {\n    const { satellite, timeManager, orbitManager, satSet } = keepTrackApi.programs;\n    if (evt.target.readyState !== 2)\n        return;\n    if (evt.target.error) {\n        console.log('error');\n        return;\n    }\n    const object = JSON.parse(evt.target.result);\n    const scc = parseInt(stringPad.pad0(object.TLE1.substr(2, 5).trim(), 5));\n    const satId = satSet.getIdFromObjNum(scc);\n    const sat = satSet.getSatExtraOnly(satId);\n    if (satellite.altitudeCheck(object.TLE1, object.TLE2, timeManager.calculateSimulationTime()) > 1) {\n        satSet.satCruncher.postMessage({\n            typ: 'satEdit',\n            id: sat.id,\n            active: true,\n            TLE1: object.TLE1,\n            TLE2: object.TLE2,\n        });\n        orbitManager.updateOrbitBuffer(sat.id, true, object.TLE1, object.TLE2);\n        sat.active = true;\n    }\n    else {\n        $('#es-error').html('Failed Altitude Check</br>Try Different Parameters');\n        $('#es-error').show();\n    }\n};\nexport const bottomMenuClick = (iconName) => {\n    var _a;\n    const { uiManager, satSet, objectManager } = keepTrackApi.programs;\n    if (iconName === 'menu-editSat') {\n        if (isEditSatMenuOpen) {\n            isEditSatMenuOpen = false;\n            uiManager.hideSideMenus();\n            return;\n        }\n        else {\n            if (objectManager.selectedSat !== -1) {\n                if (settingsManager.isMobileModeEnabled)\n                    uiManager.searchToggle(false);\n                uiManager.hideSideMenus();\n                $('#editSat-menu').effect('slide', { direction: 'left', mode: 'show' }, 1000);\n                $('#menu-editSat').addClass('bmenu-item-selected');\n                isEditSatMenuOpen = true;\n                const sat = satSet.getSatExtraOnly(objectManager.selectedSat);\n                $('#es-scc').val(sat.sccNum);\n                let inc = (sat.inclination * RAD2DEG).toPrecision(7);\n                inc = inc.split('.');\n                inc[0] = inc[0].substr(-3, 3);\n                inc[1] = inc[1].substr(0, 4);\n                inc = (inc[0] + '.' + inc[1]).toString();\n                $('#es-inc').val(stringPad.pad0(inc, 8));\n                $('#es-year').val(sat.TLE1.substr(18, 2));\n                $('#es-day').val(sat.TLE1.substr(20, 12));\n                $('#es-meanmo').val(sat.TLE2.substr(52, 11));\n                let rasc = (sat.raan * RAD2DEG).toPrecision(7);\n                rasc = rasc.split('.');\n                rasc[0] = rasc[0].substr(-3, 3);\n                rasc[1] = rasc[1].substr(0, 4);\n                rasc = (rasc[0] + '.' + rasc[1]).toString();\n                $('#es-rasc').val(stringPad.pad0(rasc, 8));\n                $('#es-ecen').val(sat.eccentricity.toPrecision(7).substr(2, 7));\n                let argPe = (sat.argPe * RAD2DEG).toPrecision(7);\n                argPe = argPe.split('.');\n                argPe[0] = argPe[0].substr(-3, 3);\n                argPe[1] = argPe[1].substr(0, 4);\n                argPe = (argPe[0] + '.' + argPe[1]).toString();\n                $('#es-argPe').val(stringPad.pad0(argPe, 8));\n                $('#es-meana').val(sat.TLE2.substr(44 - 1, 7 + 1));\n            }\n            else {\n                if ((_a = settingsManager.plugins) === null || _a === void 0 ? void 0 : _a.topMenu)\n                    keepTrackApi.programs.adviceManager.adviceList.editSatDisabled();\n                uiManager.toast(`Select a Satellite First!`, 'caution');\n                if (!$('#menu-editSat:animated').length) {\n                    $('#menu-editSat').effect('shake', {\n                        distance: 10,\n                    });\n                }\n            }\n        }\n        return;\n    }\n};\nexport const rmbMenuActions = (iconName, clickedSat) => {\n    const { uiManager, objectManager } = keepTrackApi.programs;\n    if (iconName === 'edit-sat-rmb') {\n        objectManager.setSelectedSat(clickedSat);\n        if (!isEditSatMenuOpen) {\n            uiManager.bottomIconPress({\n                currentTarget: { id: 'menu-editSat' },\n            });\n        }\n        return;\n    }\n};\nexport const hideSideMenus = () => {\n    $('#editSat-menu').effect('slide', { direction: 'left', mode: 'hide' }, 1000);\n    $('#menu-editSat').removeClass('bmenu-item-selected');\n    isEditSatMenuOpen = false;\n};\nexport const editSatNewTleClick = () => {\n    $('#loading-screen').fadeIn(1000, editSatNewTleClickFadeIn);\n};\nexport const editSatNewTleClickFadeIn = () => {\n    const { satellite, satSet, timeManager, objectManager, orbitManager, uiManager } = keepTrackApi.programs;\n    try {\n        // Update Satellite TLE so that Epoch is Now but ECI position is very very close\n        const satId = satSet.getIdFromObjNum($('#es-scc').val());\n        const mainsat = satSet.getSat(satId);\n        // Launch Points are the Satellites Current Location\n        const TEARR = mainsat.getTEARR();\n        let launchLat, launchLon, alt;\n        launchLon = satellite.degreesLong(TEARR.lon);\n        launchLat = satellite.degreesLat(TEARR.lat);\n        alt = TEARR.alt;\n        const upOrDown = mainsat.getDirection();\n        const simulationTimeObj = timeManager.calculateSimulationTime();\n        const currentEpoch = satellite.currentEpoch(simulationTimeObj);\n        mainsat.TLE1 = mainsat.TLE1.substr(0, 18) + currentEpoch[0] + currentEpoch[1] + mainsat.TLE1.substr(32);\n        keepTrackApi.programs.mainCamera.isCamSnapMode = false;\n        let TLEs;\n        // Ignore argument of perigee for round orbits OPTIMIZE\n        if (mainsat.apogee - mainsat.perigee < 300) {\n            TLEs = satellite.getOrbitByLatLon(mainsat, launchLat, launchLon, upOrDown, simulationTimeObj);\n        }\n        else {\n            TLEs = satellite.getOrbitByLatLon(mainsat, launchLat, launchLon, upOrDown, simulationTimeObj, alt);\n        }\n        const TLE1 = TLEs[0];\n        const TLE2 = TLEs[1];\n        if (TLE1 === 'Error') {\n            $('#loading-screen').fadeOut('slow');\n            uiManager.toast(`${TLE2}`, 'critical');\n            return;\n        }\n        satSet.satCruncher.postMessage({\n            typ: 'satEdit',\n            id: satId,\n            TLE1: TLE1,\n            TLE2: TLE2,\n        });\n        orbitManager.updateOrbitBuffer(satId, true, TLE1, TLE2);\n        //\n        // Reload Menu with new TLE\n        //\n        const sat = satSet.getSatExtraOnly(objectManager.selectedSat);\n        $('#es-scc').val(sat.sccNum);\n        let inc = (sat.inclination * RAD2DEG).toPrecision(7);\n        inc = inc.split('.');\n        inc[0] = inc[0].substr(-3, 3);\n        inc[1] = inc[1].substr(0, 4);\n        inc = (inc[0] + '.' + inc[1]).toString();\n        $('#es-inc').val(stringPad.pad0(inc, 8));\n        $('#es-year').val(sat.TLE1.substr(18, 2));\n        $('#es-day').val(sat.TLE1.substr(20, 12));\n        $('#es-meanmo').val(sat.TLE2.substr(52, 11));\n        let rasc = (sat.raan * RAD2DEG).toPrecision(7);\n        rasc = rasc.split('.');\n        rasc[0] = rasc[0].substr(-3, 3);\n        rasc[1] = rasc[1].substr(0, 4);\n        rasc = (rasc[0] + '.' + rasc[1]).toString();\n        $('#es-rasc').val(stringPad.pad0(rasc, 8));\n        $('#es-ecen').val(sat.eccentricity.toPrecision(7).substr(2, 7));\n        let argPe = (sat.argPe * RAD2DEG).toPrecision(7);\n        argPe = argPe.split('.');\n        argPe[0] = argPe[0].substr(-3, 3);\n        argPe[1] = argPe[1].substr(0, 4);\n        argPe = (argPe[0] + '.' + argPe[1]).toString();\n        $('#es-argPe').val(stringPad.pad0(argPe, 8));\n        $('#es-meana').val(sat.TLE2.substr(44 - 1, 7 + 1));\n    }\n    catch (error) {\n        console.debug(error);\n    }\n    $('#loading-screen').fadeOut('slow');\n};\nexport const editSatSubmit = (e) => {\n    const { satellite, satSet, timeManager, orbitManager } = keepTrackApi.programs;\n    $('#es-error').hide();\n    const scc = $('#es-scc').val();\n    const satId = satSet.getIdFromObjNum(scc);\n    if (satId === null) {\n        console.log('Not a Real Satellite');\n        e.preventDefault();\n        return false;\n    }\n    const sat = satSet.getSatExtraOnly(satId);\n    const intl = sat.TLE1.substr(9, 8);\n    let inc = $('#es-inc').val();\n    let meanmo = $('#es-meanmo').val();\n    let rasc = $('#es-rasc').val();\n    const ecen = $('#es-ecen').val();\n    let argPe = $('#es-argPe').val();\n    let meana = $('#es-meana').val();\n    const epochyr = $('#es-year').val();\n    const epochday = $('#es-day').val();\n    const { TLE1, TLE2 } = satellite.createTle({ sat, inc, meanmo, rasc, argPe, meana, ecen, epochyr, epochday, intl, scc });\n    if (satellite.altitudeCheck(TLE1, TLE2, timeManager.calculateSimulationTime()) > 1) {\n        satSet.satCruncher.postMessage({\n            typ: 'satEdit',\n            id: satId,\n            active: true,\n            TLE1: TLE1,\n            TLE2: TLE2,\n        });\n        orbitManager.updateOrbitBuffer(satId, true, TLE1, TLE2);\n        sat.active = true;\n    }\n    else {\n        $('#es-error').html('Failed Altitude Check</br>Try Different Parameters');\n        $('#es-error').show();\n    }\n    e.preventDefault();\n    return true;\n};\nexport const editSatSaveClick = (e) => {\n    const { satSet } = keepTrackApi.programs;\n    try {\n        const scc = $('#es-scc').val();\n        const satId = satSet.getIdFromObjNum(scc);\n        const sat = satSet.getSatExtraOnly(satId);\n        const sat2 = {\n            TLE1: sat.TLE1,\n            TLE2: sat.TLE2,\n        };\n        const variable = JSON.stringify(sat2);\n        const blob = new Blob([variable], {\n            type: 'text/plain;charset=utf-8',\n        });\n        saveAs(blob, scc + '.tle');\n    }\n    catch (error) {\n        // intentionally left blank\n    }\n    e.preventDefault();\n};\n"],"names":[],"sourceRoot":""}