{"version":3,"file":"src_js_plugins_recorderManager_recorderManager_ts.123b763690aac6263f61.js","mappings":";;;;;;;;;;;;;;AAAA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,oBAAoB,CAAC;AACrB,oBAAoB,CAAC;AACrB;AACA;AACA,qBAAqB;AACrB,yBAAyB,CAAC;AAC1B,wBAAwB,CAAC,mCAAmC,cAAc;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,CAAC;AACjB,gBAAgB,CAAC;AACjB;AACA;AACA,iBAAiB;AACjB;AACA,qBAAqB,CAAC;AACtB,oBAAoB,CAAC,mCAAmC,cAAc;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,CAAC;AACjB;AACA;AACA,6FAA6F,yBAAyB,2BAA2B;AACjJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,CAAC;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,qBAAqB;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD,qBAAqB;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC1JwD;AACwB;AACzD;AACvB;AACO;AACA;AACP;AACA,IAAI,6CAAC,yBAAyB,uEAAiB;AAC/C;AACA,2DAA2D;AAC3D;AACA;AACA;AACA;AACA;AACO;AACP;AACA,uBAAuB,0FAAc;AACrC;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,YAAY,6CAAC;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,gBAAgB,6CAAC;AACjB,gBAAgB,6CAAC;AACjB,qBAAqB,6CAAC;AACtB,oBAAoB,6CAAC;AACrB;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL;AACA,IAAI,2EAAqB;AACzB;AACA;AACA;AACA,KAAK;AACL","sources":["webpack://keeptrack.space/./src/js/plugins/recorderManager/CanvasRecorder.ts","webpack://keeptrack.space/./src/js/plugins/recorderManager/recorderManager.ts"],"sourcesContent":["// @ts-nocheck\nexport class CanvasRecorder {\n    constructor(videoBitsPerSec) {\n        this.checkIfRecording = () => this.isVideoRecording;\n        this.setIsRecording = (bool) => {\n            this.isVideoRecording = bool;\n        };\n        let recordedBlobs = [];\n        let supportedType = null;\n        let mediaRecorder = null;\n        const video = document.createElement('video');\n        video.style.display = 'none';\n        const startCapture = (displayMediaOptions) => {\n            displayMediaOptions !== null && displayMediaOptions !== void 0 ? displayMediaOptions : (displayMediaOptions = {\n                video: {\n                    cursor: 'never',\n                },\n                audio: false,\n            });\n            /* istanbul ignore next */\n            if (window.location.protocol === 'https:' || settingsManager.offline) {\n                if ('getDisplayMedia' in navigator) {\n                    return navigator.getDisplayMedia(displayMediaOptions).catch((err) => {\n                        console.warn('Error:' + err);\n                        return null;\n                    });\n                }\n                else if ('getDisplayMedia' in navigator.mediaDevices) {\n                    return navigator.mediaDevices.getDisplayMedia(displayMediaOptions).catch((err) => {\n                        console.warn('Error:' + err);\n                        return null;\n                    });\n                }\n                else {\n                    console.debug('No Recording Support');\n                    CanvasRecorder.isVideoRecording = false;\n                    $('#menu-record').removeClass('bmenu-item-selected');\n                    $('#menu-record').addClass('bmenu-item-disabled');\n                    M.toast({\n                        html: `Compatibility Error with Recording`,\n                    });\n                    if (!$('#menu-record:animated').length) {\n                        $('#menu-record').effect('shake', { distance: 10 });\n                    }\n                    return false;\n                }\n            }\n            else {\n                console.debug('No Recording Support in Http! Try Https!');\n                CanvasRecorder.isVideoRecording = false;\n                $('#menu-record').removeClass('bmenu-item-selected');\n                $('#menu-record').addClass('bmenu-item-disabled');\n                M.toast({\n                    html: `Recording Only Available with HTTPS`,\n                });\n                /* istanbul ignore next */\n                if (!$('#menu-record:animated').length) {\n                    $('#menu-record').effect('shake', { distance: 10 });\n                }\n                return false;\n            }\n        };\n        const startRecording = () => {\n            let selectCapture = new Promise(function (resolve) {\n                resolve(startCapture());\n            });\n            /* istanbul ignore next */\n            selectCapture\n                .then(function startRecording(srcObject) {\n                if (srcObject == false)\n                    return;\n                CanvasRecorder.isVideoRecording = true;\n                $('#menu-record').addClass('bmenu-item-selected');\n                let stream = srcObject;\n                video.srcObject = srcObject;\n                let types = ['video/webm', 'video/webm,codecs=vp9', 'video/vp8', 'video/webm;codecs=vp8', 'video/webm;codecs=daala', 'video/webm;codecs=h264', 'video/mpeg'];\n                for (let i in types) {\n                    if (window.MediaRecorder.isTypeSupported(types[i])) {\n                        supportedType = types[i];\n                        break;\n                    }\n                }\n                if (supportedType == null) {\n                    console.log('No supported type found for MediaRecorder');\n                }\n                let options = {\n                    mimeType: supportedType,\n                    videoBitsPerSecond: videoBitsPerSec || 30000000, // 30.0Mbps\n                    // videoBitsPerSecond: videoBitsPerSec || 10000000, // 10.0Mbps\n                    // videoBitsPerSecond: videoBitsPerSec || 5000000 // 5.0Mbps\n                    // videoBitsPerSecond: videoBitsPerSec || 2500000 // 2.5Mbps\n                };\n                recordedBlobs = [];\n                try {\n                    mediaRecorder = new window.MediaRecorder(stream, options);\n                }\n                catch (e) {\n                    // alert('MediaRecorder is not supported by this browser.');\n                    CanvasRecorder.isVideoRecording = false;\n                    $('#menu-record').removeClass('bmenu-item-selected');\n                    console.warn('Exception while creating MediaRecorder:', e);\n                    return;\n                }\n                console.log('Created MediaRecorder', mediaRecorder, 'with options', options);\n                mediaRecorder.onstop = handleStop;\n                mediaRecorder.ondataavailable = handleDataAvailable;\n                mediaRecorder.start(100); // collect 100ms of data blobs\n                console.log('MediaRecorder started', mediaRecorder);\n            })\n                .catch((err) => {\n                console.debug('Error:' + err);\n            });\n        };\n        /* istanbul ignore next */\n        const handleDataAvailable = (event) => {\n            if (event.data && event.data.size > 0) {\n                recordedBlobs.push(event.data);\n            }\n        };\n        /* istanbul ignore next */\n        const handleStop = (event) => {\n            console.log('Recorder stopped: ', event);\n            const superBuffer = new Blob(recordedBlobs, { type: supportedType });\n            video.src = window.URL.createObjectURL(superBuffer);\n        };\n        const stopRecording = () => {\n            if (!mediaRecorder)\n                throw new Error('MediaRecorder is not initialized');\n            mediaRecorder.stop();\n            // console.log('Recorded Blobs: ', recordedBlobs);\n            video.controls = true;\n        };\n        const save = (fileName) => {\n            const name = fileName || 'recording.webm';\n            const blob = new Blob(recordedBlobs, { type: supportedType });\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.style.display = 'none';\n            a.href = url;\n            a.download = name;\n            document.body.appendChild(a);\n            a.click();\n            setTimeout(() => {\n                document.body.removeChild(a);\n                window.URL.revokeObjectURL(url);\n            }, 100);\n        };\n        // These have to be at the bottom of the constructor\n        this.isVideoRecording = false;\n        this.start = startRecording;\n        this.stop = stopRecording;\n        this.save = save;\n    }\n}\nCanvasRecorder.isVideoRecording = false;\n","import { keepTrackApi } from '@app/js/api/keepTrackApi';\nimport { CanvasRecorder } from '@app/js/plugins/recorderManager/CanvasRecorder';\nimport $ from 'jquery';\nlet recorder;\nexport const getRecorderObject = () => recorder;\nexport const uiManagerInit = () => {\n    // Bottom Icon\n    $('#bottom-icons').append(keepTrackApi.html `\n      <div id=\"menu-record\" class=\"bmenu-item\">\n        <img alt=\"video\" src=\"\" delayedsrc=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAABmJLR0QA/wD/AP+gvaeTAAADnElEQVR4nO3cPWwbdRjH8e/jvKA2qHuFCgtUFMcXqGOxgFAkBOUlXdkgEhuDB0AIwQILS8vQEAkWhFo21nRBUBBigcZHsZ2Il04FISQWBhApceyHBZh6vTv73ur8PqvvHv/1//n/v0d3OoOIiIiIiIiIiIiIiIjINLOyB5BUfcfnZ6+zMnKeMjjpcBw4AtyW5/f2l+3/OWp03Mc9N8rsOIMqUrPjh/egzS7tERwFSDULFVfpABpb/uQevAccK3sseamVPYAbcreg429hXGSKJx+quALca42Q9x3Wyh5KESq3AhohZzggkw8V64Iaoa/hfHCTQxzjko34cDhDZ/8vfv7hIfsjk++O6HCSdDKTqMwWtHTZ6yNnI+pzg2vUeL530i4VOa68VSKAoOsLowEfAQsRh3R9npV+YL8XOa4iVOIa4AM2gPtu+BlctTkem8bJhwoE0Ah9jeiL7vUZ55nekv1W3IiKVWoAS5e9zk32fYwXui27UuCQChd5hU9732Na5d0Flb4FHXQKoGSVaENvdUHXFxjwhsOLRPyoo7YyBTChIPRVBrzjcNc45yuAMd1/xe8Z7rPuzqlJ6qQOIO+uoCxJu75mxw8PnFeGQ17FJn8apxWQQhD66p6zgXFnVjUVQAJLX/vx4Qzr7jyedW21oTGCjp8dzbBtJJr8L9PWVwAxHF4C5mIO+9Wc5/pNHklbXwFMZmCwvrvPvb2WXcAs9e2bzK4Bed87qlr3ZfA5TrvXsu1J6uginN4v5rzWa9mFLIopgOQGBu8OD/H6Tt3+zKqoAkjC+NSh3W/ad1mXVgAx3FjdbtrFvOqrC4qR5+RDASsgbfdy0J7EaQWUTAGUTAGUTAGUTAGULPcu6KB1NWlpBZRMAZRMAZRMAZRMAZQssy6oak+sbhVaATEWQ386z/oKIIY5m43QP1kM/UQe9RVAEs6j5nSDjp+r7/jtWZZWAMnNObRru3wfbPmzWRVVAOnd4cb5oOOfBVu+OGkxBTAmhxU3vgk6fu7ur/zIuHUUwGTmHNqHZv/dltxTt+IKIIbB28Ag5rCjbpxvhHyRtr4CiNFbtpdrQxYdPk5w+MNp6yuABLoP2o/by3bKjNPAT1nWVgAp9Jq2OQ8nzHkT+DuLmnpTPkbUPa7/XtLDkr2kF1VHK2BM3z5gV/ste8KM0wbXxq2jACbUa9omc9QNzgKjtOdrC4qhP+uYcgpARERERERERERERERERHL0D2BAC2IfonfQAAAAAElFTkSuQmCC\">\n        <span class=\"bmenu-title\">Record Video</span>\n        <div class=\"status-icon\"></div>\n      </div>     \n    `);\n};\nexport const uiManagerOnReady = () => {\n    try {\n        recorder = new CanvasRecorder(settingsManager.videoBitsPerSecond);\n    }\n    catch (e) {\n        console.warn(e);\n    }\n};\n/* istanbul ignore next */\nexport const bottomMenuClick = (iconName) => {\n    if (iconName === 'menu-record') {\n        if (recorder.checkIfRecording()) {\n            recorder.stop();\n            recorder.save('keeptrack.webm');\n            recorder.setIsRecording(false);\n            $('#menu-record').removeClass('bmenu-item-selected');\n            return;\n        }\n        else {\n            try {\n                recorder.start();\n            }\n            catch (e) {\n                M.toast({\n                    html: `Compatibility Error with Recording`,\n                });\n                recorder.setIsRecording(false);\n                $('#menu-record').removeClass('bmenu-item-selected');\n                $('#menu-record').addClass('bmenu-item-disabled');\n                if (!$('#menu-record:animated').length) {\n                    $('#menu-record').effect('shake', {\n                        distance: 10,\n                    });\n                }\n            }\n            return;\n        }\n    }\n};\nexport const init = () => {\n    // Add HTML\n    keepTrackApi.register({\n        method: 'uiManagerInit',\n        cbName: 'recorderManager',\n        cb: uiManagerInit,\n    });\n    keepTrackApi.register({\n        method: 'uiManagerOnReady',\n        cbName: 'recorderManager',\n        cb: uiManagerOnReady,\n    });\n    // Add JavaScript\n    keepTrackApi.register({\n        method: 'bottomMenuClick',\n        cbName: 'recordVideo',\n        cb: bottomMenuClick,\n    });\n};\n"],"names":[],"sourceRoot":""}